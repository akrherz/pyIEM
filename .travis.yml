sudo: required
addons:
  hosts:
    - iemdb
virtualenv:
  system_site_packages: true
language: python
python:
  - "2.7"
before_install:
  - sudo add-apt-repository ppa:ubuntugis/ppa -y
  - sudo apt-get update -qq
  - sudo apt-get install -qq python-pyproj python-mpltoolkits.basemap python-matplotlib python-numpy python-scipy python-psycopg2
install:
  - "pip install Shapely"
  - "pip install coveralls"
  - "pip install pandas"
  - "pip install 'Pillow<3.0'"
  - "pip install python-metar"
  - "pip install git+https://github.com/akrherz/windrose.git@darylchanges"
#  - "pip install --allow-external basemap -r requirements.txt"
before_script:
  - psql -c 'create database postgis;' -U postgres
  - psql -c 'create user nobody;' -U postgres
  - psql -c 'create user apache;' -U postgres
  - psql -c 'create database portfolio;' -U postgres
  - psql -c 'create database iem;' -U postgres
  - psql -c 'create database mesosite;' -U postgres
  - psql -c 'create database asos;' -U postgres
  - psql -U postgres -f data/schema/iem.sql iem
  - psql -U postgres -f data/schema/postgis.sql postgis
  - psql -U postgres -f data/schema/portfolio.sql portfolio
  - psql -U postgres -f data/schema/mesosite.sql mesosite
  - psql -U postgres -f data/schema/asos.sql asos
script:
  "coverage run --source=pyiem setup.py test"
after_success:
  coveralls
